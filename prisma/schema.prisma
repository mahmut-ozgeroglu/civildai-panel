generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- 1. KULLANICI (USER) ---
model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  password      String?
  
  // ROL: "COMPANY", "PROFESSIONAL", "INDIVIDUAL"
  role          String    @default("INDIVIDUAL") 

  // 1. MÜSAİTLİK DURUMU
  isAvailable       Boolean  @default(true) // Yeşil Işık (Boşta mı?)
  
  // 2. ONAY SİSTEMİ (VERIFIED)
  isVerified        Boolean  @default(false) // Mavi Tik var mı?
  verificationStatus String  @default("NONE") // NONE, PENDING, REJECTED, APPROVED
  verificationDoc   String?  // Yüklenen belgenin linki
  
  // 3. KONUM (HARİTA İÇİN)
  city              String?  // Şehir (Zaten location string'imiz vardı ama bu filtre için)
  latitude          Float?   // Enlem (Harita konumu)
  longitude         Float?   // Boylam
  // MESLEK: Sadece Profesyoneller için
  profession    String?   
  cvUrl         String?

  // --- İLİŞKİLER ---
  projects      Project[]      // Kendi oluşturduğu projeler
  jobs          Job[]          // Verdiği iş ilanları
  
  // BURADAKİ HATAYI ÇÖZMEK İÇİN AŞAĞIDAKİ APPLICATION MODELİ ŞART
  applications  Application[]  // Yaptığı başvurular
  
  // Takip Sistemi
  followedBy    Follows[] @relation("followedBy")
  following     Follows[] @relation("following")
  
  // Proje Yönetimi
  projectMemberships ProjectMember[]
  tasks         Task[]         // Atandığı görevler
  siteLogs      SiteLog[]      // Paylaştığı şantiye fotoları
  tenders       Tender[]       // Açtığı ihaleler
  proposals     Proposal[]     // Verdiği teklifler
  projectMsgs   ProjectMessage[] 
  uploadedDocs  ProjectDocument[] // Yüklediği belgeler

  // Mesajlaşma & Bildirim
  sentMsgs      Message[]      @relation("SentMessages")
  receivedMsgs  Message[]      @relation("ReceivedMessages")
  notifications Notification[] // Kullanıcının bildirimleri
  
  createdAt     DateTime       @default(now())
}

// --- 2. İŞ İLANI (JOB BOARD) ---
model Job {
  id          String   @id @default(cuid())
  title       String   // Pozisyon Adı
  description String   // Detaylar
  location    String?  // Konum
  
  // YENİ EKLENEN PROFESYONEL ALANLAR
  type        String?  // Tam Zamanlı, Yarı Zamanlı, Proje Bazlı
  workModel   String?  // Şantiyede, Ofiste, Hibrit
  salary      String?  // Örn: "30.000 - 45.000 TL"
  experience  String?  // Örn: "5+ Yıl", "Tecrübesiz"
  category    String?  // "MAVI_YAKA" veya "BEYAZ_YAKA"
  
  status      String   @default("ACTIVE") 
  
  companyId   String
  company     User     @relation(fields: [companyId], references: [id])
  
  applications Application[]

  createdAt   DateTime @default(now())
}

// --- EKSİK OLAN MODEL BU: BAŞVURULAR ---
model Application {
  id          String   @id @default(cuid())
  coverLetter String?
  name        String?
  email       String?
  resumeUrl   String?  // CV Linki
  
  // Aday (User) ilişkisi
  candidateId String?  
  candidate   User?    @relation(fields: [candidateId], references: [id])
  
  // İlan (Job) ilişkisi
  jobId       String
  job         Job      @relation(fields: [jobId], references: [id])

  createdAt   DateTime @default(now())
}

// --- 3. PROJE YÖNETİMİ (ANA MERKEZ) ---
model Project {
  id          String   @id @default(cuid())
  title       String
  description String
  location    String?
  imageUrl    String?  
  status      String   @default("ONGOING") 
  
  ownerId     String
  owner       User     @relation(fields: [ownerId], references: [id])
  
  // MODÜLLER
  members     ProjectMember[]  // Ekip
  tasks       Task[]           // İş Takibi
  siteLogs    SiteLog[]        // Şantiye Duvarı
  tenders     Tender[]         // İhaleler
  messages    ProjectMessage[] // Sohbet
  documents   ProjectDocument[] // Belgeler

  createdAt   DateTime @default(now())
}

// --- 4. BELGELER ---
model ProjectDocument {
  id          String   @id @default(cuid())
  name        String   // Dosya adı
  url         String   // Link
  type        String   // PDF, DWG
  
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id])
  
  uploaderId  String
  uploader    User     @relation(fields: [uploaderId], references: [id])
  
  createdAt   DateTime @default(now())
}

// --- 5. İŞ TAKİBİ (TASK) ---
model Task {
  id          String   @id @default(cuid())
  title       String
  status      String   @default("TODO") 
  
  projectId   String   
  project     Project  @relation(fields: [projectId], references: [id])

  userId      String?  
  user        User?    @relation(fields: [userId], references: [id])

  createdAt   DateTime @default(now())
}

// --- 6. ŞANTİYE GÜNLÜĞÜ ---
model SiteLog {
  id          String   @id @default(cuid())
  content     String
  imageUrl    String?
  mediaUrl    String?  
  
  projectId   String   
  project     Project  @relation(fields: [projectId], references: [id])

  userId      String   
  user        User     @relation(fields: [userId], references: [id])

  createdAt   DateTime @default(now())
}

// --- 7. İHALE SİSTEMİ ---
model Tender {
  id          String     @id @default(cuid())
  title       String
  description String
  budget      String?    
  deadline    DateTime?  
  status      String     @default("OPEN")
  
  projectId   String     
  project     Project    @relation(fields: [projectId], references: [id])
  
  companyId   String     
  company     User       @relation(fields: [companyId], references: [id])
  
  proposals   Proposal[] 
  
  createdAt   DateTime   @default(now())
}

model Proposal {
  id          String   @id @default(cuid())
  price       String   
  note        String?  
  status      String   @default("PENDING")
  
  tenderId    String
  tender      Tender   @relation(fields: [tenderId], references: [id])
  
  bidderId    String   
  bidder      User     @relation(fields: [bidderId], references: [id])
  
  createdAt   DateTime @default(now())
}

// --- 8. PROJE SOHBETİ ---
model ProjectMessage {
  id        String   @id @default(cuid())
  content   String
  mediaUrl  String?  
  
  projectId String
  project   Project  @relation(fields: [projectId], references: [id])
  
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  createdAt DateTime @default(now())
}

// --- 9. BİLDİRİMLER ---
model Notification {
  id          String   @id @default(cuid())
  content     String   
  link        String?  
  isRead      Boolean  @default(false)
  
  userId      String   
  user        User     @relation(fields: [userId], references: [id])
  
  createdAt   DateTime @default(now())
}

// --- 10. GENEL MESAJLAŞMA & TAKİP ---
model Message {
  id          String   @id @default(cuid())
  content     String
  isRead      Boolean  @default(false) // <-- YENİ: Okundu bilgisi

  senderId    String
  receiverId  String
  createdAt   DateTime @default(now())
  
  sender      User     @relation("SentMessages", fields: [senderId], references: [id])
  receiver    User     @relation("ReceivedMessages", fields: [receiverId], references: [id])
}

model Follows {
  follower    User @relation("following", fields: [followerId], references: [id])
  followerId  String
  following   User @relation("followedBy", fields: [followingId], references: [id])
  followingId String

  @@id([followerId, followingId])
}

// --- 11. PROJE EKİBİ ---
model ProjectMember {
  id              String   @id @default(cuid())
  roleTitle       String   
  canManageTenders Boolean @default(false) 
  canManageTasks   Boolean @default(false) 

  projectId       String
  project         Project  @relation(fields: [projectId], references: [id])

  userId          String
  user            User     @relation(fields: [userId], references: [id])

  createdAt       DateTime @default(now())

  @@unique([projectId, userId]) 
}